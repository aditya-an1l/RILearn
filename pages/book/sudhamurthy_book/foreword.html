<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foreword</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;700&family=Open+Sans:wght@400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&family=Lora:wght@400;700&family=Merriweather:wght@400;700&family=Source+Serif+Pro:wght@400;700&family=Crimson+Text:wght@400;700&family=PT+Serif:wght@400;700&family=Libre+Baskerville:wght@400;700&family=Montserrat:wght@400;700&family=Lato:wght@400;700&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="topControls">
        <button id="fontStylesToggle">Font Styles</button>
        <div id="fontStylesDropdown">
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0;">Serif Fonts</h3>
            
             <button data-font="Georgia Custom">Georgia </button>
            <button data-font="Elegant Serif">Elegant Serif</button>
            <button data-font="Classic Lora">Classic Lora</button>
            <button data-font="Merriweather Serif">Merriweather Serif</button>
            <button data-font="Source Serif Pro">Source Serif Pro</button>
            <button data-font="Crimson Text">Crimson Text</button>
            <button data-font="PT Serif">PT Serif</button>
            <button data-font="Libre Baskerville">Libre Baskerville</button>
            
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0; border-top: 1px solid #e0e0e0;">Sans-Serif Fonts</h3>
            <button data-font="Modern Sans">Modern Sans</button>
            <button data-font="Friendly Round">Friendly Round</button>
            <button data-font="Clean Design">Clean Design</button>
            <button data-font="Modern Montserrat">Modern Montserrat</button>
            <button data-font="Lato Sans">Lato Sans</button>
            <button data-font="Source Sans Pro">Source Sans Pro</button>
            
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0; border-top: 1px solid #e0e0e0;">Special Fonts</h3>
            <button data-font="Technical Mono">Technical Mono</button>
            <button data-font="Handwritten Casual">Handwritten Casual</button>
        </div>
        <button id="speakToggle">Speak</button>
    </div>

    <div id="textContainer">
        <h1 align="center"><p>Foreword</p></h1>
       <p>I was brought up in a village. Those days there were no televisions, music 
systems or VCDs at home. Our only luxury was books. I was fortunate to
 have grandparents. My grandfather was a retired school teacher and an avid
 reader. He knew a vast number of Sanskrit texts by heart and every night,
 under the dark sky with the twinkling stars, he would tell me many stories.
 These were stories from the history of India, the epics and whatever
 interesting things he had read that day in the papers and magazines. These
 tales taught me some of my first lessons in life. The Katha Saritsagara (the
 Ocean of Stories), Arabian Nights, Panchatantra, stories of Aesop, Birbal and
 Tenali Rama were told to me during those beautiful nights.</p> 

	<p>The years rolled by, and so much changed in India. Now families are
 nuclear and children rarely get to live with their grandparents. The arrival of 
TV and the dramatizations of our ancient epics brought these stories closer to
 us and helped us know them, but it also removed the power of imagination.
 Storytelling is not easy. It requires the proper modulation of voice, in order to
 create an atmosphere of horror, surprise, humour or peace. During those
 storytelling nights, I have travelled with my grandfather to the battlefield of
 Haldi Ghati in Rajasthan and cried for the dead horse Chetan. I enjoyed the 
victory of Shivaji sitting next to his great mother Jeejabai. I have been thrilled
 listening to the description of the battles of Raja Ranjit Singh and moved to
 tears with the stories of his large-heartedness. I cried when the first war of
 Independence, which the British called 'Mutiny', was lost. While listening to
 my grandfather, in my mind I became an Arab and changed my dress to walk
 the streets of Baghdad and inspect the thieves with the Wazir-e-Alam. I have
 laughed and learnt valuable lessons about knowledge and wit from the stories
 of Aesop, Tenali Rama and Birbal.</p>

 	<p>In this collection, I have tried to recreate some stories from my 
experiences, all of which have taught me something. In the course of my work
 for the Infosys Foundation and as a teacher, I meet many people, young and
 old, each of whom has enriched my life in some way. I have always wanted to
 tell these stories to the next generation. I hope you will like and enjoy reading
 them.</p>

 	<p>I want to thank Sudeshna Shome Ghosh of Penguin India. Had she not
 insisted, the stories would have remained in my mind for ever.</p>
<pre> 
Bangalore     	Sudha Murthy
January 2004   
 </pre>
    </div>

    <div id="liveSettings">
        <h3>Adjust Speech Settings</h3>
        <label>Speed:
            <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1">
            <span id="rateValue">1</span>
        </label>
        <label>Pitch:
            <input type="range" id="pitch" min="0.5" max="2" value="1" step="0.1">
            <span id="pitchValue">1</span>
        </label>
    </div>

    <div id="speechControls">
        <button id="pauseButton">Pause</button>
        <button id="resumeButton">Resume</button>
        <button id="stopButton">Stop</button>
        <button id="restartButton">Restart</button>
    </div>

    <div class="status" id="statusMessage"></div>

    <div id="settingsModal">
        <div class="modal-content">
            <h2>Select Voice Settings</h2>
            <label>Speed:
                <input type="range" id="initialRate" min="0.5" max="2" value="1" step="0.1">
                <span id="initialRateValue">1</span>
            </label>
            <label>Pitch:
                <input type="range" id="initialPitch" min="0.5" max="2" value="1" step="0.1">
                <span id="initialPitchValue">1</span>
            </label>
            <p>You can adjust these settings while the speech is playing too.</p>
            <div style="text-align: center; margin-top: 20px;">
                <button id="confirmSettings">Start Speaking</button>
            </div>
        </div>
    </div>

    <div class="navigation">
      <a href="author.html" class="nav-button prev">← Previous</a>
      <a href="chapter1.html" class="nav-button next">Next →</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Speech elements
            const synth = window.speechSynthesis;
            const speakButton = document.getElementById('speakToggle');
            const pauseButton = document.getElementById('pauseButton');
            const resumeButton = document.getElementById('resumeButton');
            const stopButton = document.getElementById('stopButton');
            const restartButton = document.getElementById('restartButton');
            const confirmButton = document.getElementById('confirmSettings');
            
            // Settings elements
            const initialRateInput = document.getElementById('initialRate');
            const initialPitchInput = document.getElementById('initialPitch');
            const initialRateValue = document.getElementById('initialRateValue');
            const initialPitchValue = document.getElementById('initialPitchValue');
            
            const rateInput = document.getElementById('rate');
            const pitchInput = document.getElementById('pitch');
            const rateValue = document.getElementById('rateValue');
            const pitchValue = document.getElementById('pitchValue');
            
            // Display elements
            const statusMessage = document.getElementById('statusMessage');
            const speechControls = document.getElementById('speechControls');
            const settingsModal = document.getElementById('settingsModal');
            const liveSettings = document.getElementById('liveSettings');
            const textContainer = document.getElementById('textContainer');

            // Font Mapping
            const fontMap = {
                'Serif Classic': 'Georgia, "Times New Roman", Times, serif',
                'Modern Sans': 'Roboto, Arial, Helvetica, sans-serif',
                'Elegant Serif': '"Playfair Display", Baskerville, "Baskerville Old Face", serif',
                'Friendly Round': '"Nunito", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif',
                'Technical Mono': '"Courier New", Courier, "Lucida Console", monospace',
                'Handwritten Casual': '"Comic Neue", "Comic Sans MS", cursive',
                'Clean Design': '"Open Sans", Arial, Helvetica, sans-serif',
                'Classic Lora': 'Lora, Georgia, serif',
                'Merriweather Serif': 'Merriweather, Georgia, serif',
                'Source Serif Pro': '"Source Serif Pro", Georgia, serif',
                'Crimson Text': '"Crimson Text", Georgia, serif',
                'PT Serif': '"PT Serif", Georgia, serif',
                'Libre Baskerville': '"Libre Baskerville", Georgia, serif',
                'Modern Montserrat': 'Montserrat, Arial, sans-serif',
                'Lato Sans': 'Lato, Arial, sans-serif',
                'Source Sans Pro': '"Source Sans Pro", Arial, sans-serif',
                'Georgia Custom': 'Georgia, serif',
            };

            // Speech state variables
            let paragraphs = [];
            let currentIndex = 0;
            let isPaused = false;
            let isStopped = false;
            let currentUtterance = null;
            let speechQueue = [];

            // Font Styles Elements
            const topControls = document.getElementById('topControls');
            const fontStylesToggle = document.getElementById('fontStylesToggle');
            const fontStylesDropdown = document.getElementById('fontStylesDropdown');
            const fontButtons = fontStylesDropdown.querySelectorAll('button');

            
            function processTextContent() {
                // Get all paragraph  in the text container
                const elements = textContainer.querySelectorAll('p, pre');
                paragraphs = Array.from(elements);
                
                
                currentIndex = 0;
                updateButtonStates();
            }

            function updateButtonStates() {
    
    pauseButton.disabled = !synth.speaking || isPaused;
    resumeButton.disabled = !(isPaused || isStopped || (currentIndex >= paragraphs.length)); 
    stopButton.disabled = !synth.speaking && !isPaused;
}


           
            function highlightCurrentParagraph(index) {
                
                paragraphs.forEach(p => p.classList.remove('highlight'));
                
                
                if (index >= 0 && index < paragraphs.length) {
                    paragraphs[index].classList.add('highlight');
                    
                   
                    paragraphs[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Font Toggle and Selection
            fontStylesToggle.addEventListener('click', (event) => {
                event.stopPropagation();
                fontStylesDropdown.style.display = fontStylesDropdown.style.display === 'block' ? 'none' : 'block';
            });

            document.addEventListener('click', (event) => {
                if (!topControls.contains(event.target)) {
                    fontStylesDropdown.style.display = 'none';
                }
            });

            fontStylesDropdown.addEventListener('click', (event) => {
                event.stopPropagation();
                const fontButton = event.target.closest('button');
                if (fontButton) {
                    const selectedFont = fontButton.getAttribute('data-font');
                    const fontFamily = fontMap[selectedFont];
                    
                    document.body.style.fontFamily = fontFamily;
                    
                    const preElements = document.getElementsByTagName('pre');
                    for (let pre of preElements) {
                        
                        if (selectedFont !== 'Technical Mono') {
                            pre.style.fontFamily = 'monospace';
                        } else {
                            pre.style.fontFamily = fontFamily;
                        }
                    }
                    
                    fontButtons.forEach(btn => {
                        btn.style.backgroundColor = btn.getAttribute('data-font') === selectedFont ? '#e0e0e0' : 'transparent';
                    });
                    
                    fontStylesDropdown.style.display = 'none';
                }
            });

           
            initialRateInput.addEventListener('input', () => initialRateValue.textContent = initialRateInput.value);
            initialPitchInput.addEventListener('input', () => initialPitchValue.textContent = initialPitchInput.value);
            
            
            rateInput.addEventListener('input', () => {
                rateValue.textContent = rateInput.value;
                if (synth.speaking && !isPaused) {
                    
                    currentUtterance.rate = parseFloat(rateInput.value);
                }
            });
            
            pitchInput.addEventListener('input', () => {
                pitchValue.textContent = pitchInput.value;
                if (synth.speaking && !isPaused) {
                    
                    currentUtterance.pitch = parseFloat(pitchInput.value);
                }
            });

            // Speak button click handler
            speakButton.addEventListener('click', () => {
                if (synth.speaking) {
                    synth.cancel();
                }
              
                // Reset state for new speech session
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                speechQueue = [];
                
                // Process text content into paragraphs
                processTextContent();
                
                
                settingsModal.style.display = 'flex';
            });

            
            confirmButton.addEventListener('click', () => {
                
                settingsModal.style.display = 'none';
                
                
                speechControls.style.display = 'flex';
                liveSettings.style.display = 'block';
                
                // Copy initial settings to live settings
                rateInput.value = initialRateInput.value;
                pitchInput.value = initialPitchInput.value;
                rateValue.textContent = rateInput.value;
                pitchValue.textContent = pitchInput.value;
              
                
                startSpeaking();
            });

            function startSpeaking() {
                
                if (synth.speaking) {
                    synth.cancel();
                }
                
                
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                speechQueue = [];
                
                
                speakNextParagraph();
            }

            function speakNextParagraph() {
                if (currentIndex >= paragraphs.length || isStopped) {
                    if (!isStopped && currentIndex >= paragraphs.length) {
                        statusMessage.textContent = 'Speech finished.';
                        
                        paragraphs.forEach(p => p.classList.remove('highlight'));
                    }
                    updateButtonStates();
                    return;
                }

                if (isPaused) return;
                
                
                const currentText = paragraphs[currentIndex].innerText.trim();
                
                if (currentText) {
                    // Highlight current paragraph
                    highlightCurrentParagraph(currentIndex);
                    
                    
                    currentUtterance = new SpeechSynthesisUtterance(currentText);
                    currentUtterance.rate = parseFloat(rateInput.value);
                    currentUtterance.pitch = parseFloat(pitchInput.value);
                    
                    // Set up event handlers
                    currentUtterance.onend = () => {
                        
                        currentIndex++;
                        if (!isPaused && !isStopped) {
                           
                            setTimeout(() => speakNextParagraph(), 300);
                        }
                        updateButtonStates();
                    };
                    
                    currentUtterance.onerror = (event) => {
                        console.error('Speech synthesis error:', event);
                        statusMessage.textContent = 'Speech error occurred.';
                        updateButtonStates();
                    };
                    
                    // Speak
                    statusMessage.textContent = 'Speaking...';
                    synth.speak(currentUtterance);
                    updateButtonStates();
                } else {
                    
                    currentIndex++;
                    speakNextParagraph();
                }
            }

            // Pause button handler
            pauseButton.addEventListener('click', () => {
                if (synth.speaking && !isPaused) {
                    synth.pause();
                    isPaused = true;
                    statusMessage.textContent = 'Speech paused.';
                    updateButtonStates();
                }
            });

            // Resume button handler 
            resumeButton.addEventListener('click', () => {
    
    synth.cancel();
    
    if (isPaused) {
        
        isPaused = false;
        statusMessage.textContent = 'Speech resumed.';
        speakNextParagraph();
    } else if (isStopped) {
        
        isStopped = false;
        statusMessage.textContent = 'Speech resumed from beginning.';
        speakNextParagraph();
    } else if (currentIndex >= paragraphs.length) {
        
        currentIndex = 0;
        statusMessage.textContent = 'Starting from beginning.';
        speakNextParagraph();
    }
    
    updateButtonStates();
});

            // Stop button handler
            stopButton.addEventListener('click', () => {
    synth.cancel();
    isStopped = true;
    isPaused = false;
    // Reset currentIndex to 0 when stopping
    currentIndex = 0;
    statusMessage.textContent = 'Speech stopped. Will restart from beginning when resumed.';
    
   
    paragraphs.forEach(p => p.classList.remove('highlight'));
    
    updateButtonStates();
});
            
            // Restart button handler
            restartButton.addEventListener('click', () => {
                synth.cancel();
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                
                // Start from beginning
                speakNextParagraph();
                statusMessage.textContent = 'Restarted from beginning.';
                
                updateButtonStates();
            });

            // Browser compatibility check
            if (!('speechSynthesis' in window)) {
                alert('Web Speech API is not supported in this browser.');
                speakButton.disabled = true;
                confirmButton.disabled = true;
                pauseButton.disabled = true;
                resumeButton.disabled = true;
                stopButton.disabled = true;
                restartButton.disabled = true;
                statusMessage.textContent = 'Speech synthesis not supported in this browser.';
            }
            
            // Fix for voice not loading issue in some browsers
            window.speechSynthesis.onvoiceschanged = () => {
                // This ensures voices are loaded before allowing speech
                if (window.speechSynthesis.getVoices().length > 0) {
                    speakButton.disabled = false;
                }
            };
            
            
            updateButtonStates();
            
            
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible' && isPaused) {
                    
                    if (synth.paused) {
                        try {
                            synth.resume();
                        } catch (e) {
                            console.error('Error resuming speech:', e);
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>