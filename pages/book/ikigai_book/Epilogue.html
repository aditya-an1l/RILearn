<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epilogue</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;700&family=Open+Sans:wght@400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&family=Lora:wght@400;700&family=Merriweather:wght@400;700&family=Source+Serif+Pro:wght@400;700&family=Crimson+Text:wght@400;700&family=PT+Serif:wght@400;700&family=Libre+Baskerville:wght@400;700&family=Montserrat:wght@400;700&family=Lato:wght@400;700&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="topControls">
        <button id="fontStylesToggle">Font Styles</button>
        <div id="fontStylesDropdown">
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0;">Serif Fonts</h3>
            
             <button data-font="Georgia Custom">Georgia </button>
            <button data-font="Elegant Serif">Elegant Serif</button>
            <button data-font="Classic Lora">Classic Lora</button>
            <button data-font="Merriweather Serif">Merriweather Serif</button>
            <button data-font="Source Serif Pro">Source Serif Pro</button>
            <button data-font="Crimson Text">Crimson Text</button>
            <button data-font="PT Serif">PT Serif</button>
            <button data-font="Libre Baskerville">Libre Baskerville</button>
            
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0; border-top: 1px solid #e0e0e0;">Sans-Serif Fonts</h3>
            <button data-font="Modern Sans">Modern Sans</button>
            <button data-font="Friendly Round">Friendly Round</button>
            <button data-font="Clean Design">Clean Design</button>
            <button data-font="Modern Montserrat">Modern Montserrat</button>
            <button data-font="Lato Sans">Lato Sans</button>
            <button data-font="Source Sans Pro">Source Sans Pro</button>
            
            <h3 style="padding: 10px; margin: 0; border-bottom: 1px solid #e0e0e0; border-top: 1px solid #e0e0e0;">Special Fonts</h3>
            <button data-font="Technical Mono">Technical Mono</button>
            <button data-font="Handwritten Casual">Handwritten Casual</button>
        </div>
        <button id="speakToggle">Speak</button>
    </div>

    <div id="textContainer">
        <h1 align="center"><p>Epilogue</p></h1>
        <h1 align="center"><p>Ikigai: The art of living</p></h1>
    <p>Mitsuo Aida was one of the most important calligraphers and haikuists of the
        twentieth century. He is yet another example of a Japanese person who dedicated
        his life to a very specific ikigai: communicating emotions with seventeen-syllable
        poems, using a shodo calligraphy brush.</p>
    <p>Many of Aida's haikus philosophize about the importance of the present
        moment, and the passage of time. The poem reproduced below could be
        translated as "In the here and now, the only thing in my life is your life."</p>
    <p>いまここにしかないわたし
        のいのちあなたのいのち</p>
    <p>In another poem, Aida writes simply, "Here, now." It is an artwork that seeks
        to evoke feelings of mono no aware (a melancholy appreciation of the
        ephemeral).
    </p>
    <p>いまここ</p>
    <p>The following poem touches on one of the secrets of bringing ikigai into our
        lives: "Happiness is always determined by your heart."
    </p>
    <p>しあわせはいつも自分の心がきめる</p>
    <p>This last one, also by Aida, means "Keep going; don't change your path."</p>
    <p>そのままでいいがな</p>
    <p>Once you discover your ikigai, pursuing it and nurturing it every day will bring
        meaning to your life. The moment your life has this purpose, you will achieve a
        happy state of flow in all you do, like the calligrapher at his canvas or the chef
        who, after half a century, still prepares sushi for his patrons with love.</p>
    <h3><p>Conclusion</p></h3>
    <p>Our ikigai is different for all of us, but one thing we have in common is that we
        are all searching for meaning. When we spend our days feeling connected to what
        is meaningful to us, we live more fully; when we lose the connection, we feel
        despair</p>
    <p>Modern life estranges us more and more from our true nature, making it very
        easy for us to lead lives lacking in meaning. Powerful forces and incentives
        (money, power, attention, success) distract us on a daily basis; don't let them take
        over your life.
    </p>
    <p>Our intuition and curiosity are very powerful internal compasses to help us
        connect with our ikigai. Follow those things you enjoy, and get away from or
        change those you dislike. Be led by your curiosity, and keep busy by doing things
        that fill you with meaning and happiness. It doesn't need to be a big thing: we
        might find meaning in being good parents or in helping our neighbors.
    </p>
    <p>There is no perfect strategy to connecting with our ikigai. But what we learned
        from the Okinawans is that we should not worry too much about finding it.</p>
    <p>Life is not a problem to be solved. Just remember to have something that
        keeps you busy doing what you love while being surrounded by the people who
        love you.</p>
    <h3><p>The ten rules of ikigai</p></h3>
    <p>We'll conclude this journey with ten rules we've distilled from the wisdom of the
        long-living residents of Ogimi:</p>
    <ol type="1">
        <li><p>Stay active; don't retire. Those who give up the things they love doing and
            do well lose their purpose in life. That's why it's so important to keep doing
            things of value, making progress, bringing beauty or utility to others, helping
            out, and shaping the world around you, even after your "official" professional
            activity has ended.</p></li>
        <li><p>Take it slow. Being in a hurry is inversely proportional to quality of life. As
            the old saying goes, "Walk slowly and you'll go far." When we leave urgency
            behind, life and time take on new meaning.</p></li>
        <li> <p>Don't fill your stomach. Less is more when it comes to eating for long life,
            too. According to the 80 percent rule, in order to stay healthier longer, we should
            eat a little less than our hunger demands instead of stuffing ourselves.</p>
        </li>
        <li> <p>Surround yourself with good friends. Friends are the best medicine,
            there for confiding worries over a good chat, sharing stories that brighten your
            day, getting advice, having fun, dreaming . . . in other words, living.</p>
        </li>
        <li> <p>Get in shape for your next birthday. Water moves; it is at its best when it
            flows fresh and doesn't stagnate. The body you move through life in needs a bit
            of daily maintenance to keep it running for a long time. Plus, exercise releases
            hormones that makbe us feel happy</p></li>
        <li><p>Smile. A cheerful attitude is not only relaxing—it also helps make friends.
            It's good to recognize the things that aren't so great, but we should never forget
            what a privilege it is to be in the here and now in a world so full of possibilities</p></li>
        <li><p>Reconnect with nature. Though most people live in cities these days,
            human beings are made to be part of the natural world. We should return to it
            often to recharge our batteries.</p></li>
        <li><p>Give thanks. To your ancestors, to nature, which provides you with the air
            you breathe and the food you eat, to your friends and family, to everything that
            brightens your days and makes you feel lucky to be alive. Spend a moment every
            day giving thanks, and you'll watch your stockpile of happiness grow.</p>
        </li>
        <li><p>Live in the moment. Stop regretting the past and fearing the future. Today
            is all you have. Make the most of it. Make it worth remembering.</p>
        </li>
        <li> <p>Follow your ikigai. There is a passion inside you, a unique talent that
            gives meaning to your days and drives you to share the best of yourself until the
            very end. If you don't know what your ikigai is yet, as Viktor Frankl says, your
            mission is to discover it.</p></li>

    </ol>
    <p style="font-size: 16px">The authors of this book wish you a long, happy, and purposeful life.
        <br> Thank you for joining us,
    </p>
    <p align="right" style="font-size: 16px">HÉCTOR GARCÍA AND FRANCESC MIRALLES</p>

    <div class="chapter-navigation">
        <a href="chapter9.html" class="nav-button prev">← Previous: Chapter 9</a>
        <a href="index.html" class="nav-button next">Next: Home →</a>
    </div>

    </div>

    <div id="liveSettings">
        <h3>Adjust Speech Settings</h3>
        <label>Speed:
            <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1">
            <span id="rateValue">1</span>
        </label>
        <label>Pitch:
            <input type="range" id="pitch" min="0.5" max="2" value="1" step="0.1">
            <span id="pitchValue">1</span>
        </label>
    </div>

    <div id="speechControls">
        <button id="pauseButton">Pause</button>
        <button id="resumeButton">Resume</button>
        <button id="stopButton">Stop</button>
        <button id="restartButton">Restart</button>
    </div>

    <div class="status" id="statusMessage"></div>

    <div id="settingsModal">
        <div class="modal-content">
            <h2>Select Voice Settings</h2>
            <label>Speed:
                <input type="range" id="initialRate" min="0.5" max="2" value="1" step="0.1">
                <span id="initialRateValue">1</span>
            </label>
            <label>Pitch:
                <input type="range" id="initialPitch" min="0.5" max="2" value="1" step="0.1">
                <span id="initialPitchValue">1</span>
            </label>
            <p>You can adjust these settings while the speech is playing too.</p>
            <div style="text-align: center; margin-top: 20px;">
                <button id="confirmSettings">Start Speaking</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Speech elements
            const synth = window.speechSynthesis;
            const speakButton = document.getElementById('speakToggle');
            const pauseButton = document.getElementById('pauseButton');
            const resumeButton = document.getElementById('resumeButton');
            const stopButton = document.getElementById('stopButton');
            const restartButton = document.getElementById('restartButton');
            const confirmButton = document.getElementById('confirmSettings');
            
            // Settings elements
            const initialRateInput = document.getElementById('initialRate');
            const initialPitchInput = document.getElementById('initialPitch');
            const initialRateValue = document.getElementById('initialRateValue');
            const initialPitchValue = document.getElementById('initialPitchValue');
            
            const rateInput = document.getElementById('rate');
            const pitchInput = document.getElementById('pitch');
            const rateValue = document.getElementById('rateValue');
            const pitchValue = document.getElementById('pitchValue');
            
            // Display elements
            const statusMessage = document.getElementById('statusMessage');
            const speechControls = document.getElementById('speechControls');
            const settingsModal = document.getElementById('settingsModal');
            const liveSettings = document.getElementById('liveSettings');
            const textContainer = document.getElementById('textContainer');

            // Font Mapping
            const fontMap = {
                'Serif Classic': 'Georgia, "Times New Roman", Times, serif',
                'Modern Sans': 'Roboto, Arial, Helvetica, sans-serif',
                'Elegant Serif': '"Playfair Display", Baskerville, "Baskerville Old Face", serif',
                'Friendly Round': '"Nunito", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif',
                'Technical Mono': '"Courier New", Courier, "Lucida Console", monospace',
                'Handwritten Casual': '"Comic Neue", "Comic Sans MS", cursive',
                'Clean Design': '"Open Sans", Arial, Helvetica, sans-serif',
                'Classic Lora': 'Lora, Georgia, serif',
                'Merriweather Serif': 'Merriweather, Georgia, serif',
                'Source Serif Pro': '"Source Serif Pro", Georgia, serif',
                'Crimson Text': '"Crimson Text", Georgia, serif',
                'PT Serif': '"PT Serif", Georgia, serif',
                'Libre Baskerville': '"Libre Baskerville", Georgia, serif',
                'Modern Montserrat': 'Montserrat, Arial, sans-serif',
                'Lato Sans': 'Lato, Arial, sans-serif',
                'Source Sans Pro': '"Source Sans Pro", Arial, sans-serif',
                'Georgia Custom': 'Georgia, serif',
            };

            // Speech state variables
            let paragraphs = [];
            let currentIndex = 0;
            let isPaused = false;
            let isStopped = false;
            let currentUtterance = null;
            let speechQueue = [];

            // Font Styles Elements
            const topControls = document.getElementById('topControls');
            const fontStylesToggle = document.getElementById('fontStylesToggle');
            const fontStylesDropdown = document.getElementById('fontStylesDropdown');
            const fontButtons = fontStylesDropdown.querySelectorAll('button');

            
            function processTextContent() {
                // Get all paragraph  in the text container
                const elements = textContainer.querySelectorAll('p, pre');
                paragraphs = Array.from(elements);
                
                
                currentIndex = 0;
                updateButtonStates();
            }

            function updateButtonStates() {
    
    pauseButton.disabled = !synth.speaking || isPaused;
    resumeButton.disabled = !(isPaused || isStopped || (currentIndex >= paragraphs.length)); 
    stopButton.disabled = !synth.speaking && !isPaused;
}


           
            function highlightCurrentParagraph(index) {
                
                paragraphs.forEach(p => p.classList.remove('highlight'));
                
                
                if (index >= 0 && index < paragraphs.length) {
                    paragraphs[index].classList.add('highlight');
                    
                   
                    paragraphs[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Font Toggle and Selection
            fontStylesToggle.addEventListener('click', (event) => {
                event.stopPropagation();
                fontStylesDropdown.style.display = fontStylesDropdown.style.display === 'block' ? 'none' : 'block';
            });

            document.addEventListener('click', (event) => {
                if (!topControls.contains(event.target)) {
                    fontStylesDropdown.style.display = 'none';
                }
            });

            fontStylesDropdown.addEventListener('click', (event) => {
                event.stopPropagation();
                const fontButton = event.target.closest('button');
                if (fontButton) {
                    const selectedFont = fontButton.getAttribute('data-font');
                    const fontFamily = fontMap[selectedFont];
                    
                    document.body.style.fontFamily = fontFamily;
                    
                    const preElements = document.getElementsByTagName('pre');
                    for (let pre of preElements) {
                        
                        if (selectedFont !== 'Technical Mono') {
                            pre.style.fontFamily = 'monospace';
                        } else {
                            pre.style.fontFamily = fontFamily;
                        }
                    }
                    
                    fontButtons.forEach(btn => {
                        btn.style.backgroundColor = btn.getAttribute('data-font') === selectedFont ? '#e0e0e0' : 'transparent';
                    });
                    
                    fontStylesDropdown.style.display = 'none';
                }
            });

           
            initialRateInput.addEventListener('input', () => initialRateValue.textContent = initialRateInput.value);
            initialPitchInput.addEventListener('input', () => initialPitchValue.textContent = initialPitchInput.value);
            
            
            rateInput.addEventListener('input', () => {
                rateValue.textContent = rateInput.value;
                if (synth.speaking && !isPaused) {
                    
                    currentUtterance.rate = parseFloat(rateInput.value);
                }
            });
            
            pitchInput.addEventListener('input', () => {
                pitchValue.textContent = pitchInput.value;
                if (synth.speaking && !isPaused) {
                    
                    currentUtterance.pitch = parseFloat(pitchInput.value);
                }
            });

            // Speak button click handler
            speakButton.addEventListener('click', () => {
                if (synth.speaking) {
                    synth.cancel();
                }
              
                // Reset state for new speech session
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                speechQueue = [];
                
                // Process text content into paragraphs
                processTextContent();
                
                
                settingsModal.style.display = 'flex';
            });

            
            confirmButton.addEventListener('click', () => {
                
                settingsModal.style.display = 'none';
                
                
                speechControls.style.display = 'flex';
                liveSettings.style.display = 'block';
                
                // Copy initial settings to live settings
                rateInput.value = initialRateInput.value;
                pitchInput.value = initialPitchInput.value;
                rateValue.textContent = rateInput.value;
                pitchValue.textContent = pitchInput.value;
              
                
                startSpeaking();
            });

            function startSpeaking() {
                
                if (synth.speaking) {
                    synth.cancel();
                }
                
                
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                speechQueue = [];
                
                
                speakNextParagraph();
            }

            function speakNextParagraph() {
                if (currentIndex >= paragraphs.length || isStopped) {
                    if (!isStopped && currentIndex >= paragraphs.length) {
                        statusMessage.textContent = 'Speech finished.';
                        
                        paragraphs.forEach(p => p.classList.remove('highlight'));
                    }
                    updateButtonStates();
                    return;
                }

                if (isPaused) return;
                
                
                const currentText = paragraphs[currentIndex].innerText.trim();
                
                if (currentText) {
                    // Highlight current paragraph
                    highlightCurrentParagraph(currentIndex);
                    
                    
                    currentUtterance = new SpeechSynthesisUtterance(currentText);
                    currentUtterance.rate = parseFloat(rateInput.value);
                    currentUtterance.pitch = parseFloat(pitchInput.value);
                    
                    // Set up event handlers
                    currentUtterance.onend = () => {
                        
                        currentIndex++;
                        if (!isPaused && !isStopped) {
                           
                            setTimeout(() => speakNextParagraph(), 300);
                        }
                        updateButtonStates();
                    };
                    
                    currentUtterance.onerror = (event) => {
                        console.error('Speech synthesis error:', event);
                        statusMessage.textContent = 'Speech error occurred.';
                        updateButtonStates();
                    };
                    
                    // Speak
                    statusMessage.textContent = 'Speaking...';
                    synth.speak(currentUtterance);
                    updateButtonStates();
                } else {
                    
                    currentIndex++;
                    speakNextParagraph();
                }
            }

            // Pause button handler
            pauseButton.addEventListener('click', () => {
                if (synth.speaking && !isPaused) {
                    synth.pause();
                    isPaused = true;
                    statusMessage.textContent = 'Speech paused.';
                    updateButtonStates();
                }
            });

            // Resume button handler 
            resumeButton.addEventListener('click', () => {
    
    synth.cancel();
    
    if (isPaused) {
        
        isPaused = false;
        statusMessage.textContent = 'Speech resumed.';
        speakNextParagraph();
    } else if (isStopped) {
        
        isStopped = false;
        statusMessage.textContent = 'Speech resumed from beginning.';
        speakNextParagraph();
    } else if (currentIndex >= paragraphs.length) {
        
        currentIndex = 0;
        statusMessage.textContent = 'Starting from beginning.';
        speakNextParagraph();
    }
    
    updateButtonStates();
});

            // Stop button handler
            stopButton.addEventListener('click', () => {
    synth.cancel();
    isStopped = true;
    isPaused = false;
    // Reset currentIndex to 0 when stopping
    currentIndex = 0;
    statusMessage.textContent = 'Speech stopped. Will restart from beginning when resumed.';
    
   
    paragraphs.forEach(p => p.classList.remove('highlight'));
    
    updateButtonStates();
});
            
            // Restart button handler
            restartButton.addEventListener('click', () => {
                synth.cancel();
                isStopped = false;
                isPaused = false;
                currentIndex = 0;
                
                // Start from beginning
                speakNextParagraph();
                statusMessage.textContent = 'Restarted from beginning.';
                
                updateButtonStates();
            });

            // Browser compatibility check
            if (!('speechSynthesis' in window)) {
                alert('Web Speech API is not supported in this browser.');
                speakButton.disabled = true;
                confirmButton.disabled = true;
                pauseButton.disabled = true;
                resumeButton.disabled = true;
                stopButton.disabled = true;
                restartButton.disabled = true;
                statusMessage.textContent = 'Speech synthesis not supported in this browser.';
            }
            
            // Fix for voice not loading issue in some browsers
            window.speechSynthesis.onvoiceschanged = () => {
                // This ensures voices are loaded before allowing speech
                if (window.speechSynthesis.getVoices().length > 0) {
                    speakButton.disabled = false;
                }
            };
            
            
            updateButtonStates();
            
            
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible' && isPaused) {
                    
                    if (synth.paused) {
                        try {
                            synth.resume();
                        } catch (e) {
                            console.error('Error resuming speech:', e);
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>